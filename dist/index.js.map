{"version":3,"file":"index.js","sources":["../src/MapPicker.tsx"],"sourcesContent":["import React, { FC } from 'react';\r\n\r\nfunction isGoogleMapScriptLoaded(id: string): boolean {\r\n    const scripts: HTMLCollectionOf<HTMLScriptElement> = document.head.getElementsByTagName('script');\r\n    for (let i: number = 0; i < scripts.length; i++) {\r\n        if (scripts[i].getAttribute('id') === id) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction loadScript(src: string, id: string) {\r\n    if (isGoogleMapScriptLoaded(id)) {\r\n        // Make sure the script is loaded\r\n        return new Promise((resolve) => setTimeout(resolve, 500));\r\n    }\r\n\r\n    const script = document.createElement('script');\r\n    script.setAttribute('async', '');\r\n    script.setAttribute('id', id);\r\n    script.src = src;\r\n    (document.querySelector('head') as any).appendChild(script);\r\n\r\n    return new Promise<void>((resolve) => {\r\n        script.onload = () => {\r\n            resolve();\r\n        };\r\n    });\r\n}\r\n\r\ntype Location = {\r\n    lat: number,\r\n    lng: number\r\n}\r\n\r\nenum MapTypeId {\r\n    Roadmap = 'roadmap',\r\n    Satellite = 'satellite',\r\n    Hybrid = 'hybrid',\r\n    Terrain = 'terrain'\r\n}\r\n\r\nenum GestureHandling {\r\n    Greedy = 'greedy',\r\n}\r\n\r\nenum DisableDoubleClickZoom {\r\n    True = 'true',\r\n    False = 'false'\r\n}\r\n\r\ntype Props = {\r\n    apiKey: string,\r\n    defaultLocation: Location;\r\n    zoom?: number;\r\n    onChangeLocation?(lat: number, lng: number): void;\r\n    onChangeZoom?(zoom: number): void;\r\n    style?: any;\r\n    className?: string;\r\n    mapTypeId?: MapTypeId;\r\n    gestureHandling?: GestureHandling;\r\n    disableDoubleClickZoom?: DisableDoubleClickZoom;\r\n}\r\n\r\nfunction isValidLocation(location: Location) {\r\n    return location && Math.abs(location.lat) <= 90 && Math.abs(location.lng) <= 180;\r\n}\r\n\r\nconst GOOGLE_SCRIPT_URL = 'https://maps.googleapis.com/maps/api/js?libraries=places&key=';\r\n\r\nconst MapPicker: FC<Props> = ({ apiKey, defaultLocation, zoom = 7, onChangeLocation, onChangeZoom, style, className, mapTypeId, gestureHandling, disableDoubleClickZoom }) => {\r\n    const MAP_VIEW_ID = 'google-map-view-' + Math.random().toString(36).substr(2, 9);\r\n    const map = React.useRef<any>(null);\r\n    const marker = React.useRef<any>(null);\r\n\r\n    function handleChangeLocation() {\r\n        if (onChangeLocation) {\r\n            const currentLocation = marker.current.getPosition();\r\n            onChangeLocation(currentLocation.lat(), currentLocation.lng());\r\n        }\r\n    }\r\n\r\n    function handleChangeZoom() {\r\n        onChangeZoom && onChangeZoom(map.current.getZoom());\r\n    }\r\n\r\n    function loadMap() {\r\n        const Google = (window as any).google;\r\n        const validLocation = isValidLocation(defaultLocation) ? defaultLocation : { lat: 0, lng: 0 };\r\n\r\n        map.current = new Google.maps.Map(document.getElementById(MAP_VIEW_ID),\r\n            {\r\n                center: validLocation,\r\n                zoom: zoom,\r\n                mapTypeId: mapTypeId,\r\n                disableDoubleClickZoom,\r\n                ...(gestureHandling && { gestureHandling }),\r\n            });\r\n\r\n        if (!marker.current) {\r\n            marker.current = new Google.maps.Marker({\r\n                position: validLocation,\r\n                map: map.current,\r\n                draggable: true\r\n            });\r\n            Google.maps.event.addListener(marker.current, 'dragend', handleChangeLocation);\r\n        } else {\r\n            marker.current.setPosition(validLocation);\r\n        }\r\n\r\n        map.current.addListener('click', function (event: any) {\r\n            const clickedLocation = event.latLng;\r\n\r\n            marker.current.setPosition(clickedLocation);\r\n            handleChangeLocation();\r\n        });\r\n\r\n        map.current.addListener('zoom_changed', handleChangeZoom);\r\n    }\r\n\r\n    React.useEffect(() => {\r\n        loadScript(GOOGLE_SCRIPT_URL + apiKey, 'google-maps-' + apiKey).then(loadMap);\r\n    }, [])  // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n    React.useEffect(() => {\r\n        if (marker.current) {\r\n            map.current.setCenter(defaultLocation);\r\n            marker.current.setPosition(defaultLocation);\r\n        }\r\n    }, [defaultLocation]);\r\n\r\n    React.useEffect(() => {\r\n        if (map.current) {\r\n            map.current.setZoom(zoom);\r\n        }\r\n    }, [zoom]);\r\n\r\n    const componentStyle = Object.assign({ width: '100%', height: '600px' }, style || {});\r\n\r\n    return (\r\n        <div id={MAP_VIEW_ID} style={componentStyle} className={className}></div>\r\n    );\r\n};\r\nexport default MapPicker;"],"names":["isGoogleMapScriptLoaded","id","scripts","document","head","getElementsByTagName","i","length","getAttribute","loadScript","src","Promise","resolve","setTimeout","script","createElement","setAttribute","querySelector","appendChild","onload","MapTypeId","GestureHandling","DisableDoubleClickZoom","isValidLocation","location","Math","abs","lat","lng","GOOGLE_SCRIPT_URL","MapPicker","apiKey","defaultLocation","zoom","onChangeLocation","onChangeZoom","style","className","mapTypeId","gestureHandling","disableDoubleClickZoom","MAP_VIEW_ID","random","toString","substr","map","React","useRef","marker","handleChangeLocation","currentLocation","current","getPosition","handleChangeZoom","getZoom","loadMap","Google","window","google","validLocation","maps","Map","getElementById","center","Marker","position","draggable","event","addListener","setPosition","clickedLocation","latLng","useEffect","then","setCenter","setZoom","componentStyle","Object","assign","width","height"],"mappings":"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"}